<script src="../tinytest.js"></script>
<script>
// FUNCTION
//  The function getChildrenFromParentId uses recursion to nest the children into a parent.
//  If a the parent property of an element is 0 or null, 
//  it does not have a parent element (and is not children of any other element).
//  At start, the array does not have a children property, it should be added 

// RETURN VALUE
//  It should return a new array
//

// SIGNATURE
//  getChildren(array);

// EXAMPLES
//   var array = [{id: 1, parent: null}, {id: 2, parent = null}]
//   getChildren(array)             // [{id: 1, parent: null}, {id: 2, parent = null}]
//
//
//   var array = [{id = "a", parent = 0}, {id = "b", parent = "a"}]
//    getChildren(array);           // [{id = "a", parent = 0, children: {id = "b", parent = "a"}}]
//
// PROTOTYPE LOGIC
//   
//   Slice array to move things until array.length === 0
//    go through the array : if element.parent = null, put it at the root of the array
//    then go through what's left of the array, 
//      * if nothing left, this is the end
//      * if there are elements left, they must have parent set : if parent === parent.id then
//            parent will have a new children property : parent.children = []
//            parent.children will have this new object in it : parent.children = []
//   
//  Slice the array until array is empty : needs a new copy of the original array
//
//  BASE CASE: there is no match for parentId anymore
//  RECURSE CASE: as long as the array to slice 
//
//


function getChildrenFromParentId(array, parentId) {
  if (parentId === "") {
    throw new Error('You should specifiy a parentIdToSearch');
  }
  
  var nestedArray = [];

  for(var i in array) {
    if(array[i].parent === parentId) {
      var childrenReturned = getChildrenFromParentId(array, array[i].id)

      if(childrenReturned.length !== 0) {
        array[i].children = childrenReturned;
      }
      nestedArray.push(array[i]);
    }
  }
  return nestedArray;
}



tests({

  'It should throw an error if no parentIdToSearch is passed in': function() {
    var isError = false;
    try {
      getChildrenFromParentId([1]);
    } catch(e) {
      isError = e instanceof Error;
    }
    eq(isError, true);

  },

  'It should return an array': function() {
    var arrayOutput = getChildrenFromParentId([], null);
    eq(Array.isArray(arrayOutput), true);
  },

  'It should return a new array': function() {
    var arrayToNest = [1];
    var arrayOutput = getChildrenFromParentId(arrayToNest, null);
    eq(arrayOutput !== arrayToNest, true);
  },

  'It should not modify the original array': function() {
    var arrayToNest = [{id: 0, parent: null}, {id: 1, parent: 0}];
    var arrayOutput = getChildrenFromParentId(arrayToNest, null);
    eq(arrayToNest[0].id, 0);
    eq(arrayToNest[1].id, 1);
  },

  'If all the elements in the array have a parent property of null, it should return an array with the elements unchanged': function() {
    var arrayToNest = [{id: 0, parent: null}, {id: 1, parent: null}];
    var arrayOutput = getChildrenFromParentId(arrayToNest, null);
    eq(arrayOutput[0].id, 0);
    eq(arrayOutput[1].id, 1);
  },

  'It should nest an array': function() {
    var arrayToNest = [{id: 0, parent: null}, {id: 1, parent: 0}];
    var arrayOutput = getChildrenFromParentId(arrayToNest, null);
    eq(arrayOutput.length, 1);
    eq(arrayOutput[0].id, 0);
    eq(arrayOutput[0].children[0].id, 1);
  },

  'It should nest an array with depth larger than 1': function() {
    var arrayToNest = [{id: 0, parent: null}, {id: 1, parent: 0}, {id: 2, parent: 1}, {id: 3, parent: 1}];
    var arrayOutput = getChildrenFromParentId(arrayToNest, null);
    eq(arrayOutput.length, 1);
    eq(arrayOutput[0].id, 0);
    eq(arrayOutput[0].children[0].id, 1);
    eq(arrayOutput[0].children[0].children.length, 2);
  }

});

</script>